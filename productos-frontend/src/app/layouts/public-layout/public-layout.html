<ng-container *ngIf="isLoggedIn$ | async as isLoggedIn; else guestNavbar">
  
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top py-2" style="background-color: #121212; border-bottom: 1px solid #E41E26;">
    <div class="container-fluid">
      
      <a class="navbar-brand d-flex align-items-center p-0" 
         [routerLink]="(userRole$ | async) === 'CLIENTE' ? '/catalogo' : '/pos/dashboard'">
        <img src="/images/Masterserv_Header2.png" 
             alt="Masterserv Logo" 
             height="65" 
             style="width: 140px; object-fit: fill;" 
             class="hover-effect my-1">
      </a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarLogged">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarLogged">
        <ul class="navbar-nav mx-auto mb-2 mb-lg-0 fw-bold text-uppercase">
          
          <ng-container *ngIf="(userRole$ | async) === 'CLIENTE'">
            <li class="nav-item mx-2">
              <a class="nav-link" routerLink="/catalogo" routerLinkActive="active">
                <i class="bi bi-grid-fill me-1"></i> Cat치logo
              </a>
            </li>
            <li class="nav-item mx-2">
              <a class="nav-link" routerLink="/portal/mis-compras" routerLinkActive="active">
                <i class="bi bi-bag-check-fill me-1"></i> Mis Compras
              </a>
            </li>
            <li class="nav-item mx-2">
              <a class="nav-link" routerLink="/portal/mis-puntos" routerLinkActive="active">
                <i class="bi bi-star-fill me-1"></i> Mis Puntos
              </a>
            </li>
          </ng-container>

          <ng-container *ngIf="(userRole$ | async) === 'ADMIN' || (userRole$ | async) === 'VENDEDOR'">
            <li class="nav-item">
              <a class="nav-link text-warning" routerLink="/pos/dashboard">
                <i class="bi bi-speedometer2 me-1"></i> Ir al Panel de Control
              </a>
            </li>
          </ng-container>
        </ul>

        <ul class="navbar-nav ms-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
              <div class="bg-danger text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 35px; height: 35px;">
                <i class="bi bi-person-fill lead"></i>
              </div>
              <div class="d-flex flex-column line-height-sm text-start">
                <span class="fw-bold" style="font-size: 0.9rem;">{{ userName$ | async }}</span>
                <span class="text-white-50" style="font-size: 0.75rem;">{{ userRoleLabel$ | async }}</span>
              </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark border-secondary shadow">
              <ng-container *ngIf="(userRole$ | async) === 'CLIENTE'">
                <li class="dropdown-header text-warning fw-bold">
                  <i class="bi bi-trophy-fill me-1"></i> {{ saldoPuntos$ | async | number }} Puntos
                </li>
                <li><a class="dropdown-item" routerLink="/portal/mi-perfil"><i class="bi bi-person-vcard me-2"></i>Mi Perfil</a></li>
                <li><hr class="dropdown-divider border-secondary"></li>
              </ng-container>
              <li>
                <a class="dropdown-item text-danger fw-bold" (click)="logout()" style="cursor: pointer;">
                  <i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesi칩n
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</ng-container>

<ng-template #guestNavbar>
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top py-2" style="background-color: #121212; border-bottom: 1px solid #E41E26;">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center p-0" routerLink="/catalogo">
        <img src="/images/Masterserv_Header2.png" alt="Logo" height="65" style="width: 140px; object-fit: fill;" class="hover-effect my-1">
      </a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarGuest">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarGuest">
        <ul class="navbar-nav mx-auto mb-2 mb-lg-0 fw-bold text-uppercase">
           <li class="nav-item">
              <a class="nav-link active" routerLink="/catalogo"><i class="bi bi-grid-fill me-1"></i> Cat치logo</a>
           </li>
        </ul>
        <div class="ms-auto d-flex gap-2">
          <a class="btn btn-outline-light btn-sm rounded-pill px-3 fw-bold" routerLink="/auth/register">
            Registrarse
          </a>
          <a class="btn btn-danger btn-sm rounded-pill px-3 fw-bold" routerLink="/auth/login">
            <i class="bi bi-box-arrow-in-right me-1"></i> Iniciar Sesi칩n
          </a>
        </div>
      </div>
    </div>
  </nav>
</ng-template>

<main class="container-fluid mt-4 px-4">
  <router-outlet></router-outlet>
</main>