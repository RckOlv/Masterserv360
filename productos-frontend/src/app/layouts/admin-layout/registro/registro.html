<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-7"> <div class="card shadow-sm">
        <div class="card-body p-4 p-md-5"> <h2 class="card-title text-center mb-4">{{ pageTitle }}</h2>
          
          <form [formGroup]="userForm" (ngSubmit)="onSubmit()">

            <p class="text-muted small">Información Personal</p>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="nombre" class="form-label">Nombre <span class="text-danger">*</span></label>
                <input type="text" id="nombre" class="form-control" formControlName="nombre"
                       [ngClass]="{ 'is-invalid': f['nombre'].invalid && f['nombre'].touched }">
                <div *ngIf="f['nombre'].invalid && f['nombre'].touched" class="invalid-feedback">
                  <div *ngIf="f['nombre'].errors?.['required']">Obligatorio.</div>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="apellido" class="form-label">Apellido <span class="text-danger">*</span></label>
                <input type="text" id="apellido" class="form-control" formControlName="apellido"
                       [ngClass]="{ 'is-invalid': f['apellido'].invalid && f['apellido'].touched }">
                <div *ngIf="f['apellido'].invalid && f['apellido'].touched" class="invalid-feedback">
                  <div *ngIf="f['apellido'].errors?.['required']">Obligatorio.</div>
                </div>
              </div>
            </div>

            <p class="text-muted small mt-2">Identificación</p>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="tipoDocumentoId" class="form-label">Tipo Doc. <span class="text-danger">*</span></label>
                <select id="tipoDocumentoId" class="form-select" formControlName="tipoDocumentoId"
                        [ngClass]="{ 'is-invalid': f['tipoDocumentoId'].invalid && f['tipoDocumentoId'].touched }">
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  <option *ngFor="let td of tiposDocumento" [ngValue]="td.id">{{ td.nombreCorto }}</option>
                </select>
                <div *ngIf="f['tipoDocumentoId'].invalid && f['tipoDocumentoId'].touched" class="invalid-feedback">
                  <div *ngIf="f['tipoDocumentoId'].errors?.['required']">Obligatorio.</div>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="documento" class="form-label">Documento <span class="text-danger">*</span></label>
                <input type="text" id="documento" class="form-control" formControlName="documento"
                       [ngClass]="{ 'is-invalid': f['documento'].invalid && f['documento'].touched }">
                <div *ngIf="f['documento'].invalid && f['documento'].touched" class="invalid-feedback">
                  <div *ngIf="f['documento'].errors?.['required']">Obligatorio.</div>
                </div>
              </div>
            </div>

            <hr class="my-3">

            <p class="text-muted small">Acceso al Sistema y Contacto</p>
            <div class="row">
              <div class="col-md-7 mb-3">
                <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                <input type="email" id="email" class="form-control" formControlName="email"
                       [ngClass]="{ 'is-invalid': f['email'].invalid && f['email'].touched }">
                <div *ngIf="f['email'].invalid && f['email'].touched" class="invalid-feedback">
                  <div *ngIf="f['email'].errors?.['required']">Obligatorio.</div>
                  <div *ngIf="f['email'].errors?.['email']">Email no válido.</div>
                </div>
              </div>
              <div class="col-md-5 mb-3">
                <label for="telefono" class="form-label">Teléfono <span class="text-danger">*</span></label>
                <input type="tel" id="telefono" class="form-control" formControlName="telefono"
                       [ngClass]="{ 'is-invalid': f['telefono'].invalid && f['telefono'].touched }">
                <div *ngIf="f['telefono'].invalid && f['telefono'].touched" class="invalid-feedback">
                  <div *ngIf="f['telefono'].errors?.['required']">Obligatorio.</div>
                </div>
              </div>
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Contraseña <span class="text-danger" *ngIf="!esEdicion">*</span></label>
              <input type="password" id="password" class="form-control" formControlName="password"
                     [placeholder]="esEdicion ? '(Dejar en blanco para no cambiar)' : ''"
                     [ngClass]="{ 'is-invalid': f['password'].invalid && f['password'].touched }">
              <div *ngIf="f['password'].invalid && f['password'].touched" class="invalid-feedback">
                <div *ngIf="f['password'].errors?.['required']">Obligatoria.</div>
                <div *ngIf="f['password'].errors?.['minlength']">Mínimo 8 caracteres.</div>
              </div>
            </div>

            <hr class="my-3">

            <p class="text-muted small">Permisos del Sistema</p>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="rolId" class="form-label">Asignar Rol <span class="text-danger">*</span></label>
                <select id="rolId" class="form-select" formControlName="rolId"
                        [ngClass]="{ 'is-invalid': f['rolId'].invalid && f['rolId'].touched }">
                  <option [ngValue]="null" disabled>Seleccione un Rol...</option>
                  <option *ngFor="let rol of roles" [ngValue]="rol.id">{{ rol.nombreRol }}</option>
                </select>
                 <div *ngIf="f['rolId'].invalid && f['rolId'].touched" class="invalid-feedback">
                  <div *ngIf="f['rolId'].errors?.['required']">El rol es obligatorio.</div>
                </div>
              </div>
              <div class="col-md-6 mb-3" *ngIf="esEdicion">
                <label for="estado" class="form-label">Estado <span class="text-danger">*</span></label>
                <select id="estado" class="form-select" formControlName="estado"
                        [ngClass]="{ 'is-invalid': f['estado'].invalid && f['estado'].touched }">
                  <option value="ACTIVO">Activo</option>
                  <option value="INACTIVO">Inactivo</option>
                  <option value="BLOQUEADO">Bloqueado</option>
                  <option value="PENDIENTE">Pendiente</option>
                </select>
              </div>
            </div>

            <div *ngIf="errorMessage" class="alert alert-danger p-2 text-center mt-3">
              {{ errorMessage }}
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
              <button type="button" class="btn btn-secondary me-md-2" [routerLink]="['/usuarios']">Cancelar</button>
              <button type="submit" class="btn btn-primary" [disabled]="userForm.invalid">
                {{ esEdicion ? 'Actualizar Usuario' : 'Guardar Usuario' }}
              </button>
            </div>

          </form> 
        </div>
      </div>
    </div>
  </div>
</div>