<div class="proveedores-container">
  <div class="card masterserv-card shadow-sm">
    
    <div class="card-header masterserv-card-header d-flex justify-content-between align-items-center">
      <h4 class="masterserv-title">
        <i class="bi bi-truck me-2"></i>Gestión de Proveedores
      </h4>
      <button *appHasPermission="'PROVEEDORES_MANAGE'" class="btn masterserv-btn-success btn-sm" (click)="navegarAFormulario()">
        <i class="bi bi-plus-lg"></i> Nuevo Proveedor
      </button>
      </div>

    <div class="card-body masterserv-card-body d-flex flex-column">

      <div class="masterserv-filter p-3 rounded border mb-3">
        <div class="row g-2 align-items-end">
          <div class="col-md-5">
            <label for="filtroNombre" class="form-label form-label-sm masterserv-label">Buscar por Razón Social o CUIT</label>
            <input type="text"
                   class="form-control form-control-sm masterserv-input"
                   id="filtroNombre"
                   placeholder="Escriba aquí..."
                   [(ngModel)]="terminoBusqueda"
                   (input)="filtrarLocalmente()">
          </div>

          <div class="col-md-3">
            <label for="filtroEstado" class="form-label form-label-sm masterserv-label">Filtrar por Estado</label>
            <select id="filtroEstado"
                    class="form-select form-select-sm masterserv-input"
                    [(ngModel)]="filtroEstado"
                    (change)="aplicarFiltros()">
              <option value="ACTIVO">Activos</option>
              <option value="INACTIVO">Inactivos</option>
              <option value="TODOS">Todos</option>
            </select>
          </div>

          <div class="col-md-2 align-self-end">
            <button class="btn masterserv-btn-secondary btn-sm w-100" (click)="reiniciarFiltros()" title="Limpiar búsqueda">
              Reiniciar
            </button>
          </div>
        </div>
      </div>
      
      <div *ngIf="isLoading" class="loading-container flex-grow-1 d-flex align-items-center justify-content-center">
        <div class="spinner-border masterserv-spinner" role="status"></div>
      </div>

      <div *ngIf="errorMessage && !isLoading" class="alert masterserv-alert-danger">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ errorMessage }}
      </div>

      <div *ngIf="!isLoading && proveedoresFiltrados.length > 0" class="table-responsive flex-grow-1">
        <table class="table table-sm align-middle masterserv-table">
          <thead class="masterserv-table-header">
            <tr>
              <th class="ps-3">Razón Social</th>
              <th>CUIT</th>
              <th>Email</th>
              <th>Teléfono</th>
              <th>Categorías</th>
              <th>Estado</th>
              <th *appHasPermission="'PROVEEDORES_MANAGE'" class="text-center pe-3">Acciones</th>
              </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of proveedoresFiltrados" class="masterserv-table-row">
              <td class="ps-3">{{ p.razonSocial }}</td>
              <td>{{ p.cuit }}</td>
              <td>{{ p.email || '-' }}</td>
              <td>{{ p.telefono || '-' }}</td>
              <td>
                <span *ngIf="!p.categoriaIds || p.categoriaIds.length === 0" class="text-metal">-</span>
                <span *ngFor="let catId of p.categoriaIds" class="badge badge-masterserv-categorias me-1">
                  {{ obtenerNombreCategoria(catId) }}
                </span>
              </td>
              <td>
                <span class="badge masterserv-badge" [ngClass]="p.estado === 'ACTIVO' ? 'masterserv-badge-success' : 'masterserv-badge-danger'">
                  {{ p.estado || 'N/A' }}
                </span>
              </td>
              <td *appHasPermission="'PROVEEDORES_MANAGE'" class="text-center pe-3">
                <div class="btn-group btn-group-sm" role="group">
                  <button class="btn masterserv-btn-outline-primary btn-action" (click)="navegarAFormulario(p.id)" title="Editar">
                    <i class="bi bi-pencil-square"></i>
                  </button>

                  <button *ngIf="p.estado === 'ACTIVO'"
                          class="btn masterserv-btn-outline-danger btn-action"
                          (click)="eliminarProveedor(p.id)"
                          title="Marcar como Inactivo">
                    <i class="bi bi-trash"></i>
                  </button>

                  <button *ngIf="p.estado === 'INACTIVO'"
                          class="btn masterserv-btn-outline-success btn-action"
                          (click)="reactivarProveedor(p.id)"
                          title="Reactivar">
                    <i class="bi bi-check-circle"></i>
                  </button>
                </div>
              </td>
              </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="!isLoading && proveedoresFiltrados.length === 0" class="alert masterserv-alert-info text-center">
        No se encontraron proveedores.
      </div>
      
    </div>
  </div>
</div>