<div class="proveedor-form-container">
  
  <div class="card masterserv-card shadow-lg">
    
    <div class="card-header masterserv-card-header">
      <h4 class="masterserv-title">
        <i class="bi bi-truck me-2"></i>{{ pageTitle }}
      </h4>
    </div>
    
    <div class="card-body masterserv-card-body">

      <div *ngIf="isLoading" class="loading-container d-flex align-items-center justify-content-center">
        <div class="spinner-border masterserv-spinner" role="status">
          <span class="visually-hidden">Cargando datos...</span>
        </div>
      </div>

      <div *ngIf="errorMessage && !isLoading" class="alert masterserv-alert-danger">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ errorMessage }}
      </div>

      <form [formGroup]="proveedorForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading">
        
        <fieldset class="mb-4">
          <legend class="masterserv-label border-bottom border-metal pb-2 mb-3">Datos de Identificación</legend>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="razonSocial" class="form-label masterserv-label">Razón Social <span class="text-danger">*</span></label>
              <input type="text" id="razonSocial" class="form-control masterserv-input" formControlName="razonSocial"
                     [ngClass]="{ 'is-invalid': f['razonSocial'].invalid && f['razonSocial'].touched }">
              <div *ngIf="f['razonSocial'].invalid && f['razonSocial'].touched" class="invalid-feedback">
                Obligatorio.
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="cuit" class="form-label masterserv-label">CUIT <span class="text-danger">*</span></label>
              <input type="text" id="cuit" class="form-control masterserv-input" formControlName="cuit"
                     [ngClass]="{ 'is-invalid': f['cuit'].invalid && f['cuit'].touched }">
              <div *ngIf="f['cuit'].invalid && f['cuit'].touched" class="invalid-feedback">
                Obligatorio.
              </div>
            </div>
          </div>
        </fieldset>

        <fieldset class="mb-4">
          <legend class="masterserv-label border-bottom border-metal pb-2 mb-3">Contacto y Ubicación</legend>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="email" class="form-label masterserv-label">Email</label>
              <input type="email" id="email" class="form-control masterserv-input" formControlName="email"
                     [ngClass]="{ 'is-invalid': f['email'].invalid && f['email'].touched }">
              <div *ngIf="f['email'].invalid && f['email'].touched" class="invalid-feedback">
                Email no válido.
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="telefono" class="form-label masterserv-label">Teléfono</label>
              <input type="tel" id="telefono" class="form-control masterserv-input" formControlName="telefono">
            </div>
          </div>

          <div class="mb-3">
            <label for="direccion" class="form-label masterserv-label">Dirección</label>
            <input type="text" id="direccion" class="form-control masterserv-input" formControlName="direccion">
          </div>
        </fieldset>

        <fieldset class="mb-4">
          <legend class="masterserv-label border-bottom border-metal pb-2 mb-3">Categorías que Provee</legend>
          
          <div *ngIf="categorias.length === 0" class="alert masterserv-alert-info text-center">
            No hay categorías activas cargadas.
          </div>

          <div class="row" formArrayName="categoriaIds">
            <div class="col-md-3 mb-2" *ngFor="let control of categoriaIdsArray.controls; let i = index">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" [formControlName]="i" [id]="'cat-' + i">
                <label class="form-check-label text-metal" [for]="'cat-' + i">
                  {{ categorias[i].nombre }}
                </label>
              </div>
            </div>
          </div>
        </fieldset>
        
        <fieldset *ngIf="esEdicion">
          <legend class="masterserv-label border-bottom border-metal pb-2 mb-3">Estado del Proveedor</legend>
          <div class="col-md-4 mb-3">
            <label for="estado" class="form-label masterserv-label">Estado <span class="text-danger">*</span></label>
            <select id="estado" class="form-select masterserv-input" formControlName="estado"
                    [ngClass]="{ 'is-invalid': f['estado'].invalid && f['estado'].touched }">
              <option value="ACTIVO">Activo</option>
              <option value="INACTIVO">Inactivo</option>
            </select>
          </div>
        </fieldset>

        <div class="d-flex justify-content-end mt-4 pt-3 border-top border-metal">
          <button type="button" class="btn masterserv-btn-secondary me-2" [routerLink]="['/pos/proveedores']" [disabled]="isLoading">
            <i class="bi bi-arrow-left me-1"></i>Cancelar
          </button>
          <button type="submit" class="btn masterserv-btn-primary" [disabled]="proveedorForm.invalid || isLoading">
            <span *ngIf="!isLoading">
              <i class="bi" [class.bi-check-lg]="!esEdicion" [class.bi-arrow-repeat]="esEdicion"></i>
              {{ esEdicion ? 'Actualizar Proveedor' : 'Guardar Proveedor' }}
            </span>
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>