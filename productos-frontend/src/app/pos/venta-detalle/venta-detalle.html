<div class="container-fluid my-4">

  <a routerLink="/ventas-historial" class="btn btn-outline-secondary mb-3"> <i class="bi bi-arrow-left"></i> Volver al Historial
  </a>

  <h4 *ngIf="venta && !isLoading">
    <i class="bi bi-receipt-cutoff"></i> Detalle de Venta #{{ venta.id }}
  </h4>
  <hr *ngIf="venta && !isLoading">

  <div *ngIf="isLoading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando detalle...</span>
    </div>
  </div>
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">{{ errorMessage }}</div>

  <div *ngIf="!isLoading && venta && !errorMessage">
    <div class="card shadow-sm">
      <div class="card-header">
        Información General
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Fecha:</strong> {{ venta.fechaVenta | date:'dd/MM/yyyy HH:mm:ss' }}</p>
            <p><strong>Cliente:</strong> {{ venta.clienteNombre || 'N/A' }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Vendedor:</strong> {{ venta.vendedorNombre || 'N/A' }}</p>
            <p><strong>Estado:</strong>
              <span class="badge ms-2" [ngClass]="{
                'bg-success': venta.estado === 'COMPLETADA',
                'bg-danger': venta.estado === 'CANCELADA',
                'bg-warning': venta.estado === 'PENDIENTE'
              }">
                {{ venta.estado }}
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="card shadow-sm mt-3">
       <div class="card-header">
         Detalles de Productos
       </div>
       <div class="card-body p-0">
          <div *ngIf="!venta.detalles || venta.detalles.length === 0" class="alert alert-warning m-3 text-center">
            Esta venta no tiene productos asociados (puede ser un error).
          </div>

          <div class="table-responsive" *ngIf="venta.detalles && venta.detalles.length > 0">
            <table class="table table-sm table-striped mb-0">
              <thead class="table-light">
                <tr>
                  <th>Producto</th>
                  <th class="text-center">Código</th>
                  <th class="text-end">Precio Unit. (Venta)</th>
                  <th class="text-center">Cantidad</th>
                  <th class="text-end">Subtotal</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let detalle of venta.detalles">
                   <td>{{ detalle.productoNombre || 'N/A' }}</td>
                   <td class="text-center">{{ detalle.productoCodigo || 'N/A' }}</td>
                   <td class="text-end">{{ detalle.precioUnitario | currency:'ARS':'symbol':'1.2-2' }}</td>
                   <td class="text-center">{{ detalle.cantidad }}</td>
                   <td class="text-end fw-bold">{{ detalle.subtotal | currency:'ARS':'symbol':'1.2-2' }}</td>
                </tr>
              </tbody>
              <tfoot>
                <tr class="table-light">
                  <td colspan="4" class="text-end fs-5 fw-bold">TOTAL VENTA:</td>
                  <td class="text-end fs-5 fw-bold">
                    {{ venta.totalVenta | currency:'ARS':'symbol':'1.2-2' }}
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
       </div>
    </div> </div> </div>